<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Autopilot Einstellungen</title>
  <link rel="stylesheet" href="style.css">

  <style>
    /* --- Allgemeine Stildefinitionen --- */
    body { background:#001d26; color:#fff; font-family:sans-serif; text-align:center; padding:20px; }
    h2 { color:#00bcd4; margin-top:20px; }

    /* Tabelle f√ºr PID Werte */
    table { margin:20px auto; border-collapse:collapse; width:80%; max-width:500px; }
    th, td { border:1px solid #00bcd4; padding:6px; }
    input[type="number"] { width:100px; background:#002b3a; color:#fff; border:1px solid #007d91; text-align:right; }

    /* Button-Leiste unten */
    .buttonBar { margin-top:30px; }
    button { margin:5px; padding:10px 18px; font-size:16px; border:none; border-radius:8px; cursor:pointer; }
    #saveBtn { background:#00bcd4; color:#000; }
    #cancelBtn { background:#444; color:#fff; }

    /* Bootsl√§ngen-Buttons */
    .boatSizeBtn { margin:4px; padding:8px 14px; background:#005566; color:#fff; border:none; border-radius:8px; cursor:pointer; }
    .boatSizeBtn:hover { background:#007d91; }

    /* Hervorhebung f√ºr aktuell gew√§hlten Bootsl√§ngen-Button */
    .boatSizeBtn.active { background:#00bcd4; color:#000; font-weight:bold; }
  </style>
</head>
<body>

  <h1>‚öôÔ∏è Autopilot&nbsp;Einstellungen</h1>

  <!-- ===================== Abschnitt A: Allgemein ===================== -->
  <h2>A&nbsp;‚Äì&nbsp;Allgemein</h2>
  <label>
    <input type="checkbox" id="invertPinne"> Pinnenrichtung invertieren
  </label><br>

  <!-- ===================== Abschnitt B: Startwerte anhand Bootsl√§nge ===================== -->
  <h2>B&nbsp;‚Äì&nbsp;Startwerte w√§hlen</h2>
  <div id="boatButtons" style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 10px;">
    <!-- Bootsl√§ngen-Buttons in 1m Schritten -->
    <button class="boatSizeBtn" onclick="setBoatSize(5)">Boot&nbsp;5 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(6)">Boot&nbsp;6 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(7)">Boot&nbsp;7 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(8)">Boot&nbsp;8 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(9)">Boot&nbsp;9 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(10)">Boot&nbsp;10 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(11)">Boot&nbsp;11 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(12)">Boot&nbsp;12 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(13)">Boot&nbsp;13 m</button>
    <button class="boatSizeBtn" onclick="setBoatSize(14)">Boot&nbsp;14 m</button>
  </div>

  <!-- ===================== Abschnitt C: PID Werte ===================== -->
  <h2>C&nbsp;‚Äì&nbsp;PID-Werte</h2>
  <table>
    <thead>
      <tr><th>See</th><th>P</th><th>I</th><th>D</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>Glatte</td>
        <td><input type="number" step="0.001" id="p1"></td>
        <td><input type="number" step="0.001" id="i1"></td>
        <td><input type="number" step="0.001" id="d1"></td>
      </tr>
      <tr>
        <td>M√§√üige</td>
        <td><input type="number" step="0.001" id="p2"></td>
        <td><input type="number" step="0.001" id="i2"></td>
        <td><input type="number" step="0.001" id="d2"></td>
      </tr>
      <tr>
        <td>Raue</td>
        <td><input type="number" step="0.001" id="p3"></td>
        <td><input type="number" step="0.001" id="i3"></td>
        <td><input type="number" step="0.001" id="d3"></td>
      </tr>
    </tbody>
  </table>

  <!-- ===================== Speichern/Abbrechen Buttons ===================== -->
  <div class="buttonBar">
    <button id="saveBtn" onclick="saveConfig()">üíæ Speichern</button>
    <button id="cancelBtn" onclick="cancelConfig()">‚ùå Abbrechen</button>
  </div>

  <script>
    // ===================== Funktion: Bootsl√§nge w√§hlen =====================
    function setBoatSize(length) {
      // --- PID-Basiswert berechnen ---
      let base = 0.1 + (length / 100); // einfache N√§herung abh√§ngig von Bootsl√§nge

      // --- PID Werte f√ºr glatte, m√§√üige und raue See setzen ---
      document.getElementById('p1').value = (base * 1.0).toFixed(3);
      document.getElementById('i1').value = (base * 0.5).toFixed(3);
      document.getElementById('d1').value = (base * 0.05).toFixed(3);

      document.getElementById('p2').value = (base * 1.2).toFixed(3);
      document.getElementById('i2').value = (base * 0.6).toFixed(3);
      document.getElementById('d2').value = (base * 0.06).toFixed(3);

      document.getElementById('p3').value = (base * 1.4).toFixed(3);
      document.getElementById('i3').value = (base * 0.7).toFixed(3);
      document.getElementById('d3').value = (base * 0.07).toFixed(3);

      // --- Visuelle Hervorhebung des aktiven Bootsl√§ngen-Buttons ---
      document.querySelectorAll('.boatSizeBtn').forEach(btn => btn.classList.remove('active')); // alte Auswahl deaktivieren
      document.querySelector(`.boatSizeBtn[onclick="setBoatSize(${length})"]`).classList.add('active'); // neue Auswahl aktiv
    }

    // ===================== Funktion: Konfiguration speichern =====================
    function saveConfig() {
      const params = new URLSearchParams({
        invert: document.getElementById('invertPinne').checked ? 1 : 0,
        p1: document.getElementById('p1').value,
        i1: document.getElementById('i1').value,
        d1: document.getElementById('d1').value,
        p2: document.getElementById('p2').value,
        i2: document.getElementById('i2').value,
        d2: document.getElementById('d2').value,
        p3: document.getElementById('p3').value,
        i3: document.getElementById('i3').value,
        d3: document.getElementById('d3').value
      });

      // --- Request an den ESP senden ---
      fetch(`/setConfig?${params.toString()}`)
        .then(r => r.text())
        .then(txt => {
          alert(txt); 
          window.location.href = "index.html"; // nach Speichern zur√ºck zur Hauptseite
        })
        .catch(() => alert("‚ùå Fehler beim Speichern"));
    }

    // ===================== Funktion: Abbrechen =====================
    function cancelConfig() {
      window.location.href = "index.html"; // ohne √Ñnderungen zur√ºck
    }
  </script>

</body>
</html>
