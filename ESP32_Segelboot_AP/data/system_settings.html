<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>System Einstellungen</title>

  <style>
    body { background:#001d26; color:#fff; font-family:sans-serif; text-align:center; padding:20px; }
    h1 { color:#00bcd4; }
    h2 { color:#00bcd4; margin-top:25px; }

    table { margin:20px auto; border-collapse:collapse; width:80%; max-width:600px; }
    th, td { border:1px solid #00bcd4; padding:6px; }
    input[type="number"], input[type="text"] {
      width:180px;
      background:#002b3a;
      color:#fff;
      border:1px solid #007d91;
      padding:4px;
    }
    input[type="checkbox"] { transform: scale(1.2); margin-right:8px; }

    .buttonBar { margin-top:30px; }
    button {
      margin:5px;
      padding:10px 18px;
      font-size:16px;
      border:none;
      border-radius:8px;
      cursor:pointer;
    }
    #saveBtn { background:#00bcd4; color:#000; }
    #cancelBtn { background:#444; color:#fff; }
  </style>
</head>
<body>

  <h1>‚öôÔ∏è System&nbsp;Einstellungen</h1>

  <!-- ===================== Abschnitt A: WLAN AP ===================== -->
  <h2>A ‚Äì WLAN Access Point</h2>
  <table>
    <tr>
      <td>SSID:</td>
      <td><input type="text" id="ap_ssid"></td>
    </tr>
    <tr>
      <td>Passwort:</td>
      <td><input type="text" id="ap_password"></td>
    </tr>
  </table>

  <!-- ===================== Abschnitt B: Sensor-Frequenzen ===================== -->
  <h2>B ‚Äì Sensor Abtastraten (Hz)</h2>
  <table>
    <tr><th>Sensor</th><th>Hz</th></tr>
    <tr><td>GPS hz</td> <td><input type="number" step="1" min="1" max="4" id="gpsHz"></td></tr>
    <tr><td>AHRS Steps</td> <td><input type="number" step="1" min="1" max="10" id="ahrsHz"></td></tr>
    <tr><td>MPU Hz</td> <td><input type="number" step="1" min="1" max="100" id="mpuHz"></td></tr>
    <tr><td>Wind Hz</td> <td><input type="number" step="1" min="1" max="10" id="windHz"></td></tr>
    <tr><td>SD Logging /min</td> <td><input type="number" step="1" min="1" max="3600" id="sdHz"></td></tr>
  </table>

  <!-- ===================== Abschnitt C: Navigation / Missweisung ===================== -->
  <h2>C ‚Äì Navigation / Missweisung</h2>
  <label><input type="checkbox" id="use_decl_compass"> Kompass Missweisung verwenden</label><br>
  <label><input type="checkbox" id="use_decl_wind"> Wind Missweisung verwenden</label><br>

  <!-- ===================== Abschnitt D: Boots Parameter ===================== -->
  <h2>D ‚Äì Boots Parameter</h2>
  <table>
    <tr>
      <td>Sensor to Tiefgang (m)</td>
      <td><input type="number" step="0.01" min="0" max="2" id="wassertiefe_einbau"></td>
    </tr>
    <tr>
      <td>Tiefgang Boot (m)</td>
      <td><input type="number" step="0.01" min="0" max="2" id="tiefgang_boot"></td>
    </tr>
  </table>

  <!-- ===================== Abschnitt E: Wasser Parameter ===================== -->
  <h2>E ‚Äì Wasser Parameter</h2>
  <table>
    <tr>
      <td>Wassertemperatur (¬∞C)</td>
      <td><input type="number" step="1" min="-5" max="40" id="wassertemperatur"></td>
    </tr>
    <tr>
      <td>Salinit√§t (‚Ä∞)</td>
      <td><input type="number" step="0.1" min="0" max="50" id="waterSalinity"></td>
    </tr>
  </table>

  <!-- ===================== Buttons ===================== -->
  <div class="buttonBar">
    <button id="saveBtn" onclick="saveSystem()">üíæ Speichern</button>
    <button id="cancelBtn" onclick="cancel()">‚ùå Abbrechen</button>
  </div>

  <script>
    // Laden der vorhandenen System Config
    fetch("/getSystem")
      .then(r => r.json())
      .then(cfg => {
        document.getElementById('ap_ssid').value          = cfg.ap_ssid;
        document.getElementById('ap_password').value      = cfg.ap_password;

        document.getElementById('gpsHz').value           = cfg.gps_hz;
        document.getElementById('ahrsHz').value          = cfg.ahrs_hz;
        document.getElementById('mpuHz').value           = cfg.mpu_hz;
        document.getElementById('windHz').value          = cfg.wind_hz;
        document.getElementById('sdHz').value            = cfg.sd_hz;

        document.getElementById('use_decl_compass').checked = cfg.use_decl_compass;
        document.getElementById('use_decl_wind').checked    = cfg.use_decl_wind;

        document.getElementById('wassertiefe_einbau').value = cfg.wassertiefe_einbau;
        document.getElementById('tiefgang_boot').value      = cfg.tiefgang_boot;

        document.getElementById('wassertemperatur').value   = cfg.wassertemperatur;
        document.getElementById('waterSalinity').value      = cfg.waterSalinity;
      })
      .catch(() => alert("‚ùå Fehler beim Laden der Konfiguration"));

    // Speichern der System Config
    function saveSystem() {
      const params = new URLSearchParams({
        ap_ssid: document.getElementById('ap_ssid').value,
        ap_password: document.getElementById('ap_password').value,

        gps_hz: document.getElementById('gpsHz').value,
        ahrs_hz: document.getElementById('ahrsHz').value,
        mpu_hz: document.getElementById('mpuHz').value,
        wind_hz: document.getElementById('windHz').value,
        sd_hz: document.getElementById('sdHz').value,

        use_decl_compass: document.getElementById('use_decl_compass').checked ? 1 : 0,
        use_decl_wind: document.getElementById('use_decl_wind').checked ? 1 : 0,

        wassertiefe_einbau: document.getElementById('wassertiefe_einbau').value,
        tiefgang_boot: document.getElementById('tiefgang_boot').value,

        wassertemperatur: document.getElementById('wassertemperatur').value,
        water_salinity: document.getElementById('waterSalinity').value
      });

      fetch(`/setSystem?${params.toString()}`)
        .then(r => r.text())
        .then(txt => { alert(txt); window.location.href="index.html"; })
        .catch(() => alert("‚ùå Fehler beim Speichern"));
    }

    function cancel() { window.location.href="index.html"; }
  </script>

</body>
</html>
